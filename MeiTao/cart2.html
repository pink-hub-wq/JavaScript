<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>购物车|美淘网</title>
    <link href="css/global.css" type="text/css" rel="stylesheet" />
    <link href="css/cart.css" type="text/css" rel="stylesheet" />
    <style type="text/css">
        /*放大图片的样式*/
        img#imgTip{
            position: absolute;
            border:1px solid #ccc;
            padding:3px;
            width:300px;
            height:185px;
            display:none;
            background-color:#eee;
        }
        #mask {
            position: absolute;
            z-index: 100;
            top: 0px;
            left: 0px;
            background-color: #000;
            filter: alpha(opacity=30);
            display: none;
            opacity: 0.3;
        }

        #dialog {
            width: 250px;
            border: 3px solid #666;
            position: fixed;
            z-index: 101;
            display: none;
            background-color: #FFF;
        }

        #dialog div.title {
            background-color: #F90;
            height: 40px;
        }

        div.title p {
            color: #fff;
            font-weight: bold;
            width: 200px;
            height: 40px;
            line-height: 40px;
            float: left;
            padding-left: 10px;
        }

        div.title img {
            padding-top: 5px;
        }

        #dialog div.content {
            padding: 15px;
            height: 50px;
            line-height: 50px;
        }

        div.content img {
            vertical-align: middle;
        }

        #dialog div.bottom {
            text-align: right;
            padding: 10px 10px 10px 0px;
            background-color: #eee;
        }

        .btn1 {
            border: 1px solid #666;
            width: 55px;
            height: 25px;
            line-height: 25px;
        }
    </style>

</head>

<body>
<iframe src="head.html" width="100%" height="104" scrolling="no" frameborder="0"></iframe>
<div id="middle">
    <div id="allnav">
        <div id="nav">
            <ul>
                <li class="menuList"><a href="#" class="category">全部商品分类</a>
                    <ul>
                        <!--二级菜单-->
                        <li><a href="#">美食</a></li>
                        <li><a href="#">旅游</a></li>
                        <li><a href="#">酒店</a></li>
                        <li><a href="#">电影</a></li>
                        <li><a href="#">KTV</a></li>
                        <li><a href="#">时尚</a></li>
                        <li><a href="#">生活服务</a></li>
                    </ul>
                </li>
                <li><a href="#">首页</a></li>
                <li><a href="#">团购</a></li>
                <li><a href="#">美食</a></li>
                <li><a href="#">电影</a></li>
                <li><a href="#">KTV</a></li>
                <li><a href="#">酒店订票</a></li>
                <li><a href="#">购物</a></li>
                <li><a href="#">品牌特卖</a></li>
            </ul>
        </div>
    </div>
    <!--导航结束-->
    <div id="content">
        <div id="ordertable">
            <ul>
                <li><img src="images/cart/g1.jpg" /></li>
                <li>我的购物车</li>
                <li class="step"></li>
            </ul>
            <form>
                <table id="tabOrder">
                    <tr>
                        <th><input type="checkbox" id="allCb" />
                            全选</th>
                        <th>项目</th>
                        <th>状态</th>
                        <th>类型/数量</th>
                        <th>单价</th>
                        <th>小计</th>
                        <th></th>
                    </tr>
                    <tr id="tr1" class="all">
                        <td><input type="checkbox" class="item2"/></td>
                        <td class="item"><a href="detail.html"> <img src="images/cart/item1.jpg" align="left"/>欢乐空间量贩式KTV：欢唱套餐2选1，国家法定节假日需到店另付20元，可升级</a></td>
                        <td>可购买</td>
                        <td><input type="button" value="-" class="btn btnMinus" />
                            <input class="txt" type="text"  value="1"/>
                            <input type="button" value="+" class="btn btnAdd"  /></td>
                        <td class="danjia">&yen;39.9</td>
                        <td class="price">&yen;39.9</td>
                        <td><a href="#" class="btnDel">删除</a></td>
                    </tr>
                    <tr id="tr2" class="all">
                        <td><input type="checkbox" class="item2" /></td>
                        <td class="item"><a href="detail.html"> <img src="images/cart/item2.jpg"align="left"/>途乐时尚主题量贩式KTV：任选1小时欢唱，可升级，提供免费WiFi</a></td>
                        <td>可购买</td>
                        <td><input type="button" value="-" class="btn btnMinus" />
                            <input class="txt" type="text" value="1"/>
                            <input  type="button" value="+" class="btn btnAdd" /></td>
                        <td class="danjia">&yen;3</td>
                        <td class="price">&yen;3</td>
                        <td><a href="#" class="btnDel">删除</a></td>
                    </tr>
                    <tr>
                        <img id="imgTip">
                        <td colspan="7" class="cal">
                            <p style="float: left;padding: 0px 26px" >
                                <input type="button" class="btn1" value="删除" id="btnDelMel"/>
                            </p>
                            已选<span id="totalnumber">2</span>件商品 应付总额： <span id="spanTotal">¥42.9</span></td>
                    </tr>
                </table>
                <p>
                    <input type="image" src="images/cart/tj.png" />
                </p>
            </form>
        </div>
        <!--订单表结束-->
        <div id="lastview">
            <h2>购买了本团购的用户还看了</h2>
            <dl>
                <dt><img src="images/cart/view1.jpg" /></dt>
                <dd>【西北湖】金鲨国际美食百汇：自助晚餐1位，西北湖店需到店补差价...</dd>
                <dd class="price"><span>¥118</span> 门店价168</dd>
                <dd class="num">已售<span>1691</span></dd>
                <dd class="add"><span></span><a href="#">加入购物车</a></dd>
            </dl>
            <dl>
                <dt><img src="images/cart/view2.jpg" /></dt>
                <dd>【台北路/香港路】金色池塘：单人晚餐自助，提供免费WiFi</dd>
                <dd class="price"><span>¥109</span> 门店价138</dd>
                <dd class="num">已售<span>2169</span></dd>
                <dd class="add"><span></span><a href="#">加入购物车</a></dd>
            </dl>
            <dl>
                <dt><img src="images/cart/view3.jpg" /></dt>
                <dd>【六渡桥/汉正街】金钱豹国际美食百汇：单人晚餐，免费WiFi，...</dd>
                <dd class="price"><span>¥198</span> 门店价238</dd>
                <dd class="num">已售<span>349</span></dd>
                <dd class="add"><span></span><a href="#">加入购物车</a></dd>
            </dl>
            <dl>
                <dt><img src="images/cart/view4.jpg" /></dt>
                <dd>【7店通用】巴犀烧烤：贵宾消费卡1张，除特价品种、酒水外全场通...</dd>
                <dd class="price"><span>¥299</span> 门店价300</dd>
                <dd class="num">已售<span>245</span></dd>
                <dd class="add"><span></span><a href="#">加入购物车</a></dd>
            </dl>
        </div>
        <!--最近浏览结束-->
    </div>
    <!--中间内容结束-->
</div>
<!--中间结束-->
<iframe src="foot.html" width="100%"  scrolling="no" frameborder="0" height="185"></iframe>
<img id="imgTip" />
<div id="mask"></div>
<div id="dialog">
    <div class="title">
        <p>删除时提示</p>
        <img src="images/del.png" id="closePic" title="关闭">
    </div>
    <div class="content">
        <img src="images/warning.jpg" width="70px"/>
        <span>您真的要删除记录吗？</span>
    </div>
    <div class="bottom">
        <input type="button" value="确定" class="btn1" id="btnSure" onclick="calItems()"/>
        <input type="button" value="取消" class="btn1" id="btnCancel"/>
    </div>
</div>
<script src="js/jquery-1.11.0.min.js"></script>
<script>
    $(function () {
        $(".item2").change(function () {
            if($(".item2").length == $(".item2:checked").length){
                $("#allCb").prop('checked',true);
            }else {
                $("#allCb").prop('checked', false);
            }
            calTotalPrice();
            calTotalNumbers();
        });
        $(".txt").change(function (){
            var num = parseInt($(this).val());
            var price = parseFloat($(this).parent("td").siblings(".danjia").text().substr(1));
            var total = num * price
            var $total1 = $(this).parent().siblings(".price");
            $total1.text("￥" + total.toFixed(2));
        })
        //商品增加/商品修改
        //修改商品数量
        //如果修改为1的状态不能再减少
        $(".btnAdd, .btnMinus").click(function () {
            var num = parseInt($(this).siblings(".txt").val());
            if ($(this).val() == "+") {
                num += 1;
            } else {
                if (num <= 1) {
                    num = 1;
                } else {
                    num -= 1;
                }
            }
            $(this).siblings(".txt").val(num);
            calPrice($(this), num);
            calTotalPrice();
            calTotalNumbers();
        });
        var b = "AAAA";
        b.to
        //修改商品小计
        function calPrice($BtnObj, number) {
            var $tdObj = $BtnObj.parent().next();
            var price = parseFloat($tdObj.text().substr(1));
            var $tdObjTotal = $tdObj.next();
            var total = price * number;
            $tdObjTotal.html("&yen;" + total.toFixed(2));
        }

        //根据是否多选框选中判断应付总额修改
        function calTotalPrice() {
            var sum = 0;
            $(".item2:checked").each(function (i,ele) {
                var price = parseFloat($(this).parent().siblings(".price").text().substr(1));
                var number = parseInt($(this).closest('tr').find('.txt').val());
                sum += price * number;//累加价格
            });
            $("#spanTotal").html("&yen;" + sum.toFixed(2));
        }
        //根据是否多选框选中判断是否已选商品数量
        function calTotalNumbers() {
            var sum = 0;
            $(".item2:checked").each(function () {
                var number = parseInt($(this).closest('tr').find('.txt').val());
                sum += number; // 累加数量
            });
            $("#totalnumber").html(sum);
        }

        // 全选多选框
        // 点击全选，让所有商品多选框修改为选中状态
        // 修改已选商品数量、应付总额
        $("#allCb").change(function () {
            if($("#allCb").prop("checked")){
                $(".item2").prop("checked",true)
            }else {
                $(".item2").prop("checked",false)
            }
        });
        calTotalPrice();
        calTotalNumbers();
        //此时为单行删除
        var isMulDel = false;//是否多行删除
        $(".btnDel").click(function () {
            $delete1 = $(this).parent("td").parent("tr");//先记住可能要删掉的那行
            showMask();
            $("#dialog").show();
            isMulDel = false;//此时为单行删除
            setDialog();
        });
        //此时为多行删除
        $("#btnDelMel").click(function () {
            showMask();
            $("#dialog").show();
            isMulDel = true;//此时为多行删除
            setDialog();
        });
        //当点击确认时，判断是多行删除还是单行删除
        //如果是多行删除，把所有选中的tr删掉，同时如果选中了所有的tr，删掉后把全选取消掉
        $("#btnSure").click(function () {
            //此时为多行删除
            if (isMulDel) {
                if($(".item2:checked").length===$(".item").length){
                    $("#allCb").prop('checked', false);
                    $(".item2:checked").closest("tr").remove();
                }else {
                    $(".item2:checked").closest("tr").remove();
                }
            } else {
                // 此时为单行删除
                $delete1.remove();
            }
            calTotalPrice();
            calTotalNumbers();
            $("#dialog, #mask").hide();
        });
        //点×或者取消，关闭覆盖层
        $("#dialog .title img, #btnCancel").click(function () {
            $("#mask, #dialog").hide();
        });
        //对话框
        function setDialog() {
            var $wObj = $(window);
            var $dObj = $("#dialog");
            var widW = $wObj.width();
            var widH = $wObj.height();
            var diaW = $dObj.width();
            var diaH = $dObj.height();
            var left = (widW - diaW) / 2;
            var top = (widH - diaH) / 2;
            $dObj.css({"left": left, "top": top});
        }
        //覆盖层
        function showMask() {
            var bh = $("body").height();
            var bw = $("body").width();
            $("#mask").css({
                height: bh + "px",
                width: bw + "px",
                display: "block"
            });
        }
        //放大镜
        var x = 150, y = 50;
        $("img").mouseover(function (e) {
            $("#imgTip").attr("src", this.src).css({
                "top": (e.pageY + y) + "px",
                "left": (e.pageX + x) + "px",
            }).show();
        });
        $("img").mouseout(function () {
            $("#imgTip").hide();
        });
        // 加入购物车
        // 点击加入购物车超链接，将商品信息加入到购物车中
        $(".add a").click(function () {
            var $tr = $("<tr class='all'></tr>");
            $("table tr:last").before($tr);
            $tr.append($("<td><input type='checkbox' class='item2'></td>"));
            var pic = $(this).parents("dl").children("dt").children("img").attr("src");
            var dption = $(this).parents("dl").children("dd:eq(0)").text();
            $tr.append($("<td class='item'><img align='left'class='img1' src='" + pic + "' style='width:75px;height:45px;margin-right:10px;'>" +
                "<a href='#'>" + dption + "</a></td>"));
            $tr.append($("<td>可购买</td>"));
            var $num = $("<td></td>");
            var $d = $("<input type='button' value='-' class='btn btnMinus'/>");
            var $txt = $("<input type='text' class='txt' value='1'/>");
            var $plus = $("<input type='button' value='+' class='btn btnAdd'/>");
            $num.append($d).append($txt).append($plus);
            $tr.append($num);
            var priceText = $(this).parents("dl").children("dd").children("span:eq(0)").text();
            var price = parseFloat(priceText.substring(1));
            $tr.append($("<td>&yen;" + price.toFixed(2) + "</td>"));
            $tr.append($("<td class='price'>&yen;" + price.toFixed(2) + "</td>"));
            $tr.append($("<td><a href='#' class='btnDel' onclick='return false'>删除</a></td>"));
            // 如果全选按钮为选中状态，加入购物车后全选按钮取消
            if ($("#allCb").prop('checked')) {
                $("#allCb").prop('checked', false);
            }
            //先把之前用到的都解绑
            $('.btnAdd,.btnMinus,.btnDel,#allCb,.btnDel,#btnSure,#dialog .title img, #btnCancel').unbind('click');
            $('input[type="checkbox"][name="item"]', '.txt').unbind('change');
            $("img").unbind("mouseover,mouseout");
            //以下代码和上面一样
            $(".item2").change(function () {
                if($(".item2:checked").length == $(".item2").length){
                    $("#allCb").prop('checked',true);
                }else {
                    $("#allCb").prop('checked', false);
                }
                calTotalPrice();
                calTotalNumbers();
            });
            $(".txt").change(function (){
                var num = parseInt($(this).val());
                var price = parseFloat($(this).parent("td").siblings(".danjia").text().substr(1));
                var total = num * price
                var $total1 = $(this).parent().siblings(".price");
                $total1.text("￥" + total.toFixed(2));
            })
            //商品增加/商品修改
            //修改商品数量
            //如果修改为1的状态不能再减少
            $(".btnAdd, .btnMinus").click(function () {
                var num = parseInt($(this).siblings(".txt").val());
                if ($(this).val() == "+") {
                    num += 1;
                } else {
                    if (num <= 1) {
                        num = 1;
                    } else {
                        num -= 1;
                    }
                }
                $(this).siblings(".txt").val(num);
                calPrice($(this), num);
                calTotalPrice();
                calTotalNumbers();
            });
            //修改商品小计
            function calPrice($BtnObj, number) {
                var $tdObj = $BtnObj.parent().next();
                var price = parseFloat($tdObj.text().substr(1));
                var $tdObjTotal = $tdObj.next();
                var total = price * number;
                $tdObjTotal.html("&yen;" + total.toFixed(2));
            }

            //根据是否多选框选中判断应付总额修改
            function calTotalPrice() {
                var sum = 0;
                $(".item2:checked").each(function (i,ele) {
                    var price = parseFloat($(this).parent().siblings(".price").text().substr(1));
                    var number = parseInt($(this).closest('tr').find('.txt').val());
                    sum += price * number;//累加价格
                });
                $("#spanTotal").html("&yen;" + sum.toFixed(2));
            }
            //根据是否多选框选中判断是否已选商品数量
            function calTotalNumbers() {
                var sum = 0;
                $(".item2:checked").each(function () {
                    var number = parseInt($(this).closest('tr').find('.txt').val());
                    sum += number; // 累加数量
                });
                $("#totalnumber").html(sum);
            }

            // 全选多选框
            // 点击全选，让所有商品多选框修改为选中状态
            // 修改已选商品数量、应付总额
            $("#allCb").change(function () {
                if($("#allCb").prop("checked")){
                    $(".item2").prop("checked",true)
                }else {
                    $(".item2").prop("checked",false)
                }
            });
            calTotalPrice();
            calTotalNumbers();
            //此时为单行删除
            var isMulDel = false;//是否多行删除
            $(".btnDel").click(function () {
                $delete1 = $(this).parent("td").parent("tr");//先记住可能要删掉的那行
                showMask();
                $("#dialog").show();
                isMulDel = false;//此时为单行删除
                setDialog();
            });
            //此时为多行删除
            $("#btnDelMel").click(function () {
                showMask();
                $("#dialog").show();
                isMulDel = true;//此时为多行删除
                setDialog();
            });
            //当点击确认时，判断是多行删除还是单行删除
            //如果是多行删除，把所有选中的tr删掉，同时如果选中了所有的tr，删掉后把全选取消掉
            $("#btnSure").click(function () {
                //此时为多行删除
                if (isMulDel) {
                    if($(".item2:checked").length===$(".item2").length){
                        $("#allCb").prop('checked', false);
                        $(".item2:checked").closest("tr").remove();
                    }else {
                        $(".item2:checked").closest("tr").remove();
                    }
                } else {
                    // 此时为单行删除
                    $delete1.remove();
                }
                calTotalPrice();
                calTotalNumbers();
                $("#dialog, #mask").hide();
            });
            //点×或者取消，关闭覆盖层
            $("#dialog .title img, #btnCancel").click(function () {
                $("#mask, #dialog").hide();
            });
            //对话框
            function setDialog() {
                var $wObj = $(window);
                var $dObj = $("#dialog");
                var widW = $wObj.width();
                var widH = $wObj.height();
                var diaW = $dObj.width();
                var diaH = $dObj.height();
                var left = (widW - diaW) / 2;
                var top = (widH - diaH) / 2;
                $dObj.css({"left": left, "top": top});
            }
            //覆盖层
            function showMask() {
                var bh = $("body").height();
                var bw = $("body").width();
                $("#mask").css({
                    height: bh + "px",
                    width: bw + "px",
                    display: "block"
                });
            }
            //放大镜
            var x = 150, y = 50;
            $("img").mouseover(function (e) {
                $("#imgTip").attr("src", this.src).css({
                    "top": (e.pageY + y) + "px",
                    "left": (e.pageX + x) + "px",
                }).show();
            });
            $("img").mouseout(function () {
                $("#imgTip").hide();
            });
        });
    });
</script>
</body>
</html>
